<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Whisper by eclecticlogic</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Whisper</h1>
          <h2>Logback appender that suppresses error message spam when the unexpected happens ...</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/eclecticlogic/whisper/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/eclecticlogic/whisper/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/eclecticlogic/whisper" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <h1>
<a id="what-is-whisper" class="anchor" href="#what-is-whisper" aria-hidden="true"><span class="octicon octicon-link"></span></a>What is Whisper?</h1>

<p>Have you ever had something go wrong in your production server and had your Logback email appender immediately send you an email alert? You probably felt like a DevOps guru because you knew exactly what caused the error before anyone else. But then you realize that you've got a database issue and every user request from the app results in an error email (possibly more than one). Right at that time a backend process launches and tries to connect to the database and all hell breaks loose because your email server is now straining under the error email deluge - all 50,000 of them saying the same thing - some variation of "could not connect to database"!</p>

<p>Perhaps you weren't so fortunate to see this happen in real-time. Perhaps the first time you noticed it was when you got back into work and saw the 50,000 new emails awaiting your attention. And as you sit and delete page after page of email, you have this suspicion that perhaps somewhere in those 50,000 emails (all looking alike) there is a one-off error email that may be important and you are going to accidentally delete it.</p>

<p>Whisper is your solution to controlling error email spam. Whisper acts as a pass through appender to your default SMTP appender for emails.
When the frequency of a message exceeds the configured threshold, Whisper starts to suppress it. While suppression is on, Whisper will even send you periodic digests letting you know which messages were suppressed and how many of them were suppressed. When things gets resolved and your error message frequency drops, suppression is stopped and things resume as normal. All of this happens on a per log message basis (not including the timestamp and factoring away parameters if you used the parameterized SLF4j log format).</p>

<h3>
<a id="what-logging-frameworks-does-whisper-support" class="anchor" href="#what-logging-frameworks-does-whisper-support" aria-hidden="true"><span class="octicon octicon-link"></span></a>What Logging frameworks does Whisper support?</h3>

<p>Whisper currently supports Logback. We hope to add support for log4j and log4jv2 in the future.</p>

<h3>
<a id="how-do-i-get-the-jar" class="anchor" href="#how-do-i-get-the-jar" aria-hidden="true"><span class="octicon octicon-link"></span></a>How do I get the JAR?</h3>

<p>Whisper is available via Maven Central. </p>

<pre><code>&lt;groupId&gt;com.eclecticlogic&lt;/groupId&gt;
&lt;artifactId&gt;whisper&lt;/artifactId&gt;
&lt;packaging&gt;jar&lt;/packaging&gt;
&lt;version&gt;1.0.4&lt;/version&gt;
</code></pre>

<h3>
<a id="how-do-i-configure-whisper" class="anchor" href="#how-do-i-configure-whisper" aria-hidden="true"><span class="octicon octicon-link"></span></a>How do I configure Whisper?</h3>

<p>You can refer to the whisper-logback-sample.xml under src/sample/resources. Here is the gist of how to configure Whisper for use with Logback to 
handle the most common case of suppressing ERROR messages that are sent via the email appender. </p>

<p>To configure the Whisper appender, first you must configure two other appenders - the regular email appender for ERROR level logs and a second
email appender for sending the suppression Digests when suppression is actually in effect. </p>

<pre><code>&lt;appender name="errorEmail" class="ch.qos.logback.classic.net.SMTPAppender"&gt;
    &lt;filter class="ch.qos.logback.classic.filter.LevelFilter"&gt;
        &lt;level&gt;ERROR&lt;/level&gt;
        &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt;
        &lt;onMismatch&gt;DENY&lt;/onMismatch&gt;
    &lt;/filter&gt;
    &lt;smtpHost&gt;ADDRESS-OF-YOUR-SMTP-HOST&lt;/smtpHost&gt;
    &lt;to&gt;EMAIL-DESTINATION&lt;/to&gt;
    &lt;from&gt;SENDER-EMAIL&lt;/from&gt;
    &lt;subject&gt;TESTING: %logger{20} - %m&lt;/subject&gt;
    &lt;layout class="ch.qos.logback.classic.PatternLayout"&gt;
        &lt;pattern&gt;%date %-5level %logger{35} - %message%n&lt;/pattern&gt;
    &lt;/layout&gt;
&lt;/appender&gt;

&lt;appender name="errorDigest" class="ch.qos.logback.classic.net.SMTPAppender"&gt;
    &lt;smtpHost&gt;ADDRESS-OF-YOUR-SMTP-HOST&lt;/smtpHost&gt;
    &lt;to&gt;EMAIL-DESTINATION&lt;/to&gt;
    &lt;from&gt;SENDER-EMAIL&lt;/from&gt;
    &lt;subject&gt;%X{whisper.digest.subject}&lt;/subject&gt;
    &lt;layout class="ch.qos.logback.classic.PatternLayout"&gt;
        &lt;pattern&gt;%date %-5level %logger{35} - %message%n&lt;/pattern&gt;
    &lt;/layout&gt;
&lt;/appender&gt;
</code></pre>

<p>Note the use of <code>%X{whisper.digest.subject}</code> for the subject of the digest appender.</p>

<p>We now configure the Whisper appender as shown below:</p>

<pre><code>&lt;appender name="whisper"
    class="com.eclecticlogic.whisper.logback.WhisperAppender"&gt;
    &lt;!-- Filter out non error logs --&gt;
    &lt;filter class="ch.qos.logback.classic.filter.LevelFilter"&gt;
        &lt;level&gt;ERROR&lt;/level&gt;
        &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt;
        &lt;onMismatch&gt;DENY&lt;/onMismatch&gt;
    &lt;/filter&gt;
    &lt;!-- This is the name of the logging category to use to send out error digests. This is associated with the 
    errorDigest appender. --&gt;
    &lt;digestLoggerName&gt;digest.appender.logger&lt;/digestLoggerName&gt;
    &lt;!--  suppressAfter specifies the criteria to enter suppression. The example below says that if 3 errors of the same kind
    are encountered within a 5 minute window, then suppression should kick in. --&gt;
    &lt;!-- Other expressions: 4 in 30 seconds, 10 in 1 hour, etc. --&gt;
    &lt;suppressAfter&gt;3 in 5 minutes&lt;/suppressAfter&gt;
    &lt;!-- expireAfter specifies how much of silence the logger between messages before stopping suppression. --&gt; 
    &lt;expireAfter&gt;4 minutes&lt;/expireAfter&gt;
    &lt;!-- digestFrequency specifies how often error email digests should be sent containing statistics on messages 
    suppressed --&gt;
    &lt;!-- You can also specify the unit as sec, seconds, min, hour, hr, hrs (not beyond hours) --&gt;
    &lt;digestFrequency&gt;20 minutes&lt;/digestFrequency&gt;

    &lt;!-- The pass-through appender for the normal case when suppression is not in-force. --&gt;
    &lt;appender-ref ref="errorEmail" /&gt;
&lt;/appender&gt;
</code></pre>

<p>The digest logger name is then associated with the digestAppender and the whisper appender is included in the 
list of default appenders:</p>

<pre><code>&lt;logger name="digest.appender.logger" level="error" additivity="false"&gt;
    &lt;appender-ref ref="errorDigest" /&gt;
&lt;/logger&gt;

&lt;root level="debug"&gt;
    &lt;appender-ref ref="whisper" /&gt;
    &lt;appender-ref ref="fileAppender" /&gt;
&lt;/root&gt;
</code></pre>

<h3>
<a id="what-is-the-license" class="anchor" href="#what-is-the-license" aria-hidden="true"><span class="octicon octicon-link"></span></a>What is the license?</h3>

<p>Good old <a href="http://apache.org/licenses/LICENSE-2.0.html">Apache License</a>.</p>

<h1>
<a id="release-notes" class="anchor" href="#release-notes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Release Notes</h1>

<h3>
<a id="v104" class="anchor" href="#v104" aria-hidden="true"><span class="octicon octicon-link"></span></a>v1.0.4</h3>

<ul>
<li>Fixed <a href="https://github.com/eclecticlogic/whisper/issues/6">bug</a> caused when the log message itself is null.</li>
</ul>

<h3>
<a id="v103" class="anchor" href="#v103" aria-hidden="true"><span class="octicon octicon-link"></span></a>v1.0.3</h3>

<ul>
<li>Fixed <a href="https://github.com/eclecticlogic/whisper/issues/4">bug</a> that leaves Muffler in the map</li>
</ul>

<h3>
<a id="v102" class="anchor" href="#v102" aria-hidden="true"><span class="octicon octicon-link"></span></a>v1.0.2</h3>

<ul>
<li>Fixed issue causing digest to continue to report no suppression as described <a href="https://github.com/eclecticlogic/whisper/issues/3">here</a>.</li>
</ul>

<h3>
<a id="v101" class="anchor" href="#v101" aria-hidden="true"><span class="octicon octicon-link"></span></a>v1.0.1</h3>

<ul>
<li>Fixed issue (NPE on digest run) described <a href="https://github.com/eclecticlogic/whisper/issues/1">here</a>.</li>
</ul>
        </section>

        <footer>
          Whisper is maintained by <a href="https://github.com/eclecticlogic">eclecticlogic</a><br>
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

                  <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-54980372-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

      </div>
    </div>
  </body>
</html>