{"name":"Whisper","tagline":"Logback appender that suppresses error message spam when things go crazy!","body":"### What is Whisper?\r\nHave you ever had something go wrong in your production server and had your Logback email appender immediately send you an email alert? \r\nYou probably felt like a DevOps guru because you knew exactly what caused the error before anyone else. But then you realize that \r\nyou've got a database issue and every user request from the app results in an error email (possibly more than one). \r\nRight at that time a backend process launches and tries to connect to the database and all hell breaks loose because your \r\nemail server is now straining under the error email deluge - all 50,000 of them saying the same thing - \r\nsome variation of \"could not connect to database\"!\r\n\r\nPerhaps you weren't so fortunate to see this happen in real-time. Perhaps the first time you noticed it was when you got back into work\r\nand saw the 50,000 new emails awaiting your attention. And as you sit and delete page after page of email, you have this \r\nsuspicion that perhaps somewhere in those 50,000 emails (all looking alike) there is a one-off error email that may be important and you are \r\ngoing to accidentally delete it.\r\n\r\nWhisper is your solution to controlling error email spam. Whisper acts like an Appender funnel. You configure a frequency above \r\nwhich error messages should be suppressed and Whisper will do just that. While suppression is on, Whisper will even send you periodic \r\nemails (through an SMTP delegate appender) letting you know which messages were suppressed and how many of them were suppressed \r\nsince the last digest. When things gets resolved and your error message frequency drops below your configured threshold, \r\nsuppression is stopped and things resume as normal. And all of this happens on a per email message (not including the timestamp). If you\r\ndiligently parameterized your log messages (SLF4j), then Whisper will even suppress similar messages ignoring parameter variations.\r\n\r\n### What Logging frameworks does Whisper support?\r\nWhisper currently supports Logback. We hope to release support for log4j and log4jv2 soon. With logback, if your messages are parameterized, Whisper will suppress messages that are the same but only differ based on parameters. This is one more reason to take advantage of sl4j's parameterized log messages.\r\n\r\n### How do I get the JAR?\r\nWhisper is available via Maven Central. TBD Details.\r\n\r\n### How do I configure Whisper?\r\nYou can refer to the whisper-logback-sample.xml under src/sample/resources. Here is the gist of how to configure Whisper for use with Logback to \r\nhandle the most common case of suppressing ERROR messages that are sent via the email appender. \r\n\r\nTo configure the Whisper appender, first you must configure two other appenders - the regular email appender for ERROR level logs and a second\r\nemail appender for sending the suppression Digests when suppression is actually in effect. \r\n\r\n```\r\n<appender name=\"errorEmail\" class=\"ch.qos.logback.classic.net.SMTPAppender\">\r\n\t<filter class=\"ch.qos.logback.classic.filter.LevelFilter\">\r\n\t\t<level>ERROR</level>\r\n\t\t<onMatch>ACCEPT</onMatch>\r\n\t\t<onMismatch>DENY</onMismatch>\r\n\t</filter>\r\n\t<smtpHost>ADDRESS-OF-YOUR-SMTP-HOST</smtpHost>\r\n\t<to>EMAIL-DESTINATION</to>\r\n\t<from>SENDER-EMAIL</from>\r\n\t<subject>TESTING: %logger{20} - %m</subject>\r\n\t<layout class=\"ch.qos.logback.classic.PatternLayout\">\r\n\t\t<pattern>%date %-5level %logger{35} - %message%n</pattern>\r\n\t</layout>\r\n</appender>\r\n\r\n<appender name=\"errorDigest\" class=\"ch.qos.logback.classic.net.SMTPAppender\">\r\n\t<smtpHost>ADDRESS-OF-YOUR-SMTP-HOST</smtpHost>\r\n\t<to>EMAIL-DESTINATION</to>\r\n\t<from>SENDER-EMAIL</from>\r\n\t<subject>%X{whisper.digest.subject}</subject>\r\n\t<layout class=\"ch.qos.logback.classic.PatternLayout\">\r\n\t\t<pattern>%date %-5level %logger{35} - %message%n</pattern>\r\n\t</layout>\r\n</appender>\r\n``` \r\n\r\nNote the use of `%X{whisper.digest.subject}` for the subject of the digest appender.\r\n\r\nWe now configure the Whisper appender as shown below:\r\n\r\n```\r\n<appender name=\"whisper\"\r\n\tclass=\"com.eclecticlogic.whisper.logback.WhisperAppender\">\r\n\t<!-- Filter out non error logs -->\r\n\t<filter class=\"ch.qos.logback.classic.filter.LevelFilter\">\r\n\t\t<level>ERROR</level>\r\n\t\t<onMatch>ACCEPT</onMatch>\r\n\t\t<onMismatch>DENY</onMismatch>\r\n\t</filter>\r\n\t<!-- This is the name of the logging category to use to send out error digests. This is associated with the \r\n\terrorDigest appender. -->\r\n\t<digestLoggerName>digest.appender.logger</digestLoggerName>\r\n\t<!--  suppressAfter specifies the criteria to enter suppression. The example below says that if 3 errors of the same kind\r\n\tare encountered within a 5 minute window, then suppression should kick in. -->\r\n\t<suppressAfter>3 in 5 minutes</suppressAfter>\r\n\t<!-- expireAfter specifies how much of silence the logger should see for the error message being suppressed \r\n\tbefore stopping suppression. --> \r\n\t<expireAfter>4 minutes</expireAfter>\r\n\t<!-- digestFrequency specifies how often error email digests should be sent containing statistics on messages \r\n\tsuppressed -->\r\n\t<digestFrequency>20 minutes</digestFrequency>\r\n\t\r\n\t<!-- The pass-through appender for the normal case when suppression is not in-force. -->\r\n\t<appender-ref ref=\"errorEmail\" />\r\n</appender>\r\n```\r\n\r\nThe digest logger name is then associated with the digestAppender and the whisper appender is included in the \r\nlist of default appenders:\r\n\r\n```\r\n<logger name=\"digest.appender.logger\" level=\"error\" additivity=\"false\">\r\n\t<appender-ref ref=\"errorDigest\" />\r\n</logger>\r\n\r\n<root level=\"debug\">\r\n\t<appender-ref ref=\"whisper\" />\r\n\t<appender-ref ref=\"fileAppender\" />\r\n</root>\r\n```\r\n\r\n### What is the license?\r\nGood old [Apache License](http://apache.org/licenses/LICENSE-2.0.html).\r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}